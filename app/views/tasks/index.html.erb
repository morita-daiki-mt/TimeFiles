<div class="createtask">
  <button type="button" class="btn btn-outline-dark btn-block hidebtn" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
    ADD NEW TASK
  </button>
  <div class="collapse" id="collapseExample">
    <div class="card" style="margin-top: -1rem;">
      <div class="card-body show-info" style="display: block;">
        <%= form_with(model: @task, local: true) do |f| %>
          <div class="form-group row">
            <label class = "col-sm-2 col-form-label text-muted" for="">TASK NAME</label>
            <div class="col-sm-9">
              <%= f.text_field :content, class:'form-control' %>
            </div>
          </div>
          <div class="form-group row">
            <div class="input-group date" data-target-input="nearest">
              <%= f.fields_for :histories do |history| %>
                <label class = "col-sm-2 col-form-label text-muted" for="">LAST DATE</label>
                <div class="col-sm-9 historyinput">
                  <%= history.text_field :action_at, id: "action_at", class: 'form-control datetimepicker-input', data: { target: '#action_at'} %>
                  <span class = "input-group-append" data-target = "#action_at" data-toggle = "datetimepicker">
                      <span class = "input-group-text"><i class = "fa fa-calendar"></i></span>
                  </span>
                </div>
              <% end %>
            </div>
          </div>
          <div class="text-right">
            <%= f.submit 'CREATE', class: 'btn btn-outline-dark' %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
<%#======================================%>
<div class="task_index">
  <% @tasks.each do |task| %>
    <% @histories = task.histories.order(action_at: :desc).first %>
    <div class="card">
      <div class="card-body">
        <p style="width: 50px;"><%= image_tag task.icon.thumb.url %></p>
        <div class="row index-namedate">
          <h4 class="col-md-5"><%= link_to task.content, task, style: "color: #555555;" %></h4>
          <div class="col-md-6">
            <% if @histories.present? %>
              <h5><%= (Date.today - @histories.action_at).to_i %> DAYS AGO</h5> 
            <% else %>
              <h5 class="text-warning">NO DATE</h5>
            <% end %>
          </div>
        </div>
        <div class="task_menu">
          <%= form_with(model:[task, @history]) do |f| %>
            <%= f.hidden_field :task_id, :value => task.id %>
            <%= f.hidden_field :action_at, :value => Date.today %>
            <%= f.submit 'TODAY', class: 'btn btn-outline-dark mb-1' %>
          <% end %>
          <button type="button" class="btn btn-dark btn-sm"><%= link_to 'show', task %></button>
          <%= link_to task, method: :delete, data: 
            { confirm: 'タスクを削除しますか?',
              cancel: 'やめる',
              commit: '削除する'}, title: '削除確認', class: 'deletebtn' do %>
            <i class="fa fa-lg fa-remove fa-fw" style="color:firebrick"></i>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
</div>